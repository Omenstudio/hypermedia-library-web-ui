var App={};App.currentObjects=[],App.currentModel=null,App.initialize=function(){var e={};if(window.location.search.length>1)for(var t,r=0,n=window.location.search.substr(1).split("&");r<n.length;r++)t=n[r].split("="),e[unescape(t[0])]=t.length>1?unescape(t[1]):"";"url"in e&&$(".addressbar .url").val(e.url),$(".addressbar").submit(function(e){e.preventDefault();var t=$(this).find(".url").val().trim();{if(t.length)return 0!==t.indexOf("http")&&(t="http://"+t),Service.load(t),!1;alert("Please, enter valid URL")}}),$(".control-buttons .btn").click(function(){$(".control-buttons .btn").removeClass("btn-primary"),$(this).addClass("btn-primary")})},App.showArticles=function(){showOverlay(),setTimeout(function(){App.currentModel=Article,App.loadDataFromService(Article),App.buildCollectionView(Article),hideOverlay()},1)},App.showBooks=function(){$(".service-item-list").text("Books")},App.showAuthors=function(){$(".service-item-list").text("Authors")},App.showPublishers=function(){$(".service-item-list").text("showPublishers")},App.loadDataFromService=function(e){App.currentObjects=[];var t=loadRegularUrl(e.collectionUrl).members.__value;for(var r in t){var n=t[r]["@id"].__value.__value["@id"];App.currentObjects.push(loadRegularUrl(n))}},App.buildCollectionView=function(e){for(var t="<ul>",r=0,n=App.currentObjects[r];r<App.currentObjects.length;++r,n=App.currentObjects[r]){t+='<li><a href="javascript:App.showElement('+r+')">'+n.title.__value.__value["@value"]+"</a></li>"}t+="</ul>",$(".service-item-list").html(t)},App.showElement=function(e){var t="<ul>";for(var r in App.currentObjects[e]){var n=App.currentObjects[e][r],i=n.__value.__orig_value;n.__iri;t+="<li>"+i+"</li>"}t+="</ul>",$(".service-item-content").html(t)};function showOverlay(){$("#overlay").css("display","grid")}function hideOverlay(){$("#overlay").css("display","none")}$(document).ready(function(){hideOverlay(),App.initialize()});var Article={};Article.id="http://schema.org/Article",Article.collectionButtonSelector="",Article.mapped=!1,Article.collectionUrl="",Article.properties=["http://schema.org/headline","http://schema.org/description","http://schema.org/pageStart","http://schema.org/pageEnd","http://schema.org/wordCount","vocab:AuthorCollection","http://schema.org/Book"];var Models=[Article];function invokeRequest(e,t,r,n){var i={type:e||"GET",headers:n||{Accept:"application/ld+json, application/json;q=0.1"},processData:!1,data:r||null,dataType:"text",async:!1};return $.ajax("proxy.php?url="+encodeURI(t),i)}function getHeaders(e){return"HTTP/1.1 "+e.status+" "+e.statusText+"\n"+e.getAllResponseHeaders()}function parseLinkHeader(e){var t={};if(!e||0===e.trim().length)return t;for(var r=e.split(","),n=r.length-1;n>=0;n--){for(var i,o,a=r[n].split(";"),l=a.length-1;l>=0;l--)if("<"===a[l].trim()[0])i=a[l].trim().slice(1,-1);else{var c=a[l].split("=");2===c.length&&"rel"===c[0].trim()&&(o=c[1].trim().slice(1,-1))}i&&o&&(t[o]=i)}return t}function parseDocumentationUrlAndLoad(e){var t=parseLinkHeader(e.getResponseHeader("Link"));return t["http://www.w3.org/ns/hydra/core#apiDocumentation"]||alert("Cannot find link to vocab header"),loadDocumentation(t["http://www.w3.org/ns/hydra/core#apiDocumentation"])}function loadDocumentation(e){var t={};return $.ajax({url:"proxy.php",dataType:"json",async:!1,data:{url:e,vocab:1},success:function(e){var r=e["@graph"];for(var n in r)t[r[n]["@id"]]=r[n]},error:function(){alert("Failed to parse vocab")}}),t}function loadRegularUrl(e){var t=[];return invokeRequest("GET",e).done(function(e){t=JSON.parse(e)}),t}var Service={};Service.doc="nothing",Service.load=function(e){showOverlay(),setTimeout(function(){Service._parseEntryPointAndDocumentation(e),hideOverlay()},1)},Service._parseEntryPointAndDocumentation=function(e){invokeRequest("GET",e).done(function(e,t,r){"nothing"===Service.doc&&(Service.doc=parseDocumentationUrlAndLoad(r)),e=JSON.parse(e);for(var n in e)if("@"!==n[0])for(var i=e[n],o=i.__value.__value["@id"],a=Service.doc[i.__iri].range,l=Service.doc[a].member_of,c=(Service.doc[a].description,0),s=Models[c];c<Models.length;++c,s=Models[c])s.id===l&&(s.collectionUrl=o,s.mapped=!0)})};